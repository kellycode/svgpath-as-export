const TAU=2*Math.PI;class A2C{static arcToBezierCurves(t,e,a,s,r,i,h,n,c){const o=Math.sin(c*TAU/360),u=Math.cos(c*TAU/360);let l=u*(t-a)/2+o*(e-s)/2,p=-o*(t-a)/2+u*(e-s)/2;if(0===l&&0===p)return[];if(0===h||0===n)return[];h=Math.abs(h),n=Math.abs(n);let f=l*l/(h*h)+p*p/(n*n);f>1&&(h*=Math.sqrt(f),n*=Math.sqrt(f));let g=this.__get_arc_center(t,e,a,s,r,i,h,n,o,u),d=[],x=g[2],v=g[3],_=Math.max(Math.ceil(Math.abs(v)/(TAU/4)),1);v/=_;for(let t=0;t<_;t++)d.push(this.__approximate_unit_arc(x,v)),x+=v;return d.map((function(t){for(let e=0;e<t.length;e+=2){let a=t[e+0],s=t[e+1];a*=h,s*=n;let r=u*a-o*s,i=o*a+u*s;t[e+0]=r+g[0],t[e+1]=i+g[1]}return t}))}static __approximate_unit_arc(t,e){var a=4/3*Math.tan(e/4),s=Math.cos(t),r=Math.sin(t),i=Math.cos(t+e),h=Math.sin(t+e);return[s,r,s-r*a,r+s*a,i+h*a,h-i*a,i,h]}static __unit_vector_angle(t,e,a,s){var r=t*a+e*s;return r>1&&(r=1),r<-1&&(r=-1),(t*s-e*a<0?-1:1)*Math.acos(r)}static __get_arc_center(t,e,a,s,r,i,h,n,c,o){var u=o*(t-a)/2+c*(e-s)/2,l=-c*(t-a)/2+o*(e-s)/2,p=h*h,f=n*n,g=u*u,d=l*l,x=p*f-p*d-f*g;x<0&&(x=0),x/=p*d+f*g;var v=(x=Math.sqrt(x)*(r===i?-1:1))*h/n*l,_=x*-n/h*u,m=o*v-c*_+(t+a)/2,M=c*v+o*_+(e+s)/2,S=(u-v)/h,P=(l-_)/n,A=(-u-v)/h,k=(-l-_)/n,y=this.__unit_vector_angle(1,0,S,P),C=this.__unit_vector_angle(S,P,A,k);return 0===i&&C>0&&(C-=TAU),1===i&&C<0&&(C+=TAU),[m,M,y,C]}}const EPSILON=1e-10,TORAD=Math.PI/180;class Ellipse{constructor(t,e,a){this.rx=t,this.ry=e,this.ax=a}transform(t){var e=Math.cos(this.ax*TORAD),a=Math.sin(this.ax*TORAD),s=[this.rx*(t[0]*e+t[2]*a),this.rx*(t[1]*e+t[3]*a),this.ry*(-t[0]*a+t[2]*e),this.ry*(-t[1]*a+t[3]*e)],r=s[0]*s[0]+s[2]*s[2],i=s[1]*s[1]+s[3]*s[3],h=((s[0]-s[3])*(s[0]-s[3])+(s[2]+s[1])*(s[2]+s[1]))*((s[0]+s[3])*(s[0]+s[3])+(s[2]-s[1])*(s[2]-s[1])),n=(r+i)/2;if(h<1e-10*n)return this.rx=this.ry=Math.sqrt(n),this.ax=0,this;var c=s[0]*s[1]+s[2]*s[3],o=n+(h=Math.sqrt(h))/2,u=n-h/2;return this.ax=Math.abs(c)<1e-10&&Math.abs(o-i)<1e-10?90:180*Math.atan(Math.abs(c)>Math.abs(o-i)?(o-r)/c:c/(o-i))/Math.PI,this.ax>=0?(this.rx=Math.sqrt(o),this.ry=Math.sqrt(u)):(this.ax+=90,this.rx=Math.sqrt(u),this.ry=Math.sqrt(o)),this}isDegenerate(){return this.rx<1e-10*this.ry||this.ry<1e-10*this.rx}}function combine(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}function Matrix(t){if(!(this instanceof Matrix))return console.log("new matrix "+t),new Matrix;this.queue=[],this.cache=null}Matrix.prototype.queueMatrix=function(t){return 1===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&0===t[4]&&0===t[5]||(this.cache=null,this.queue.push(t)),this},Matrix.prototype.translate=function(t,e){return 0===t&&0===e||(this.cache=null,this.queue.push([1,0,0,1,t,e])),this},Matrix.prototype.scale=function(t,e){return 1===t&&1===e||(this.cache=null,this.queue.push([t,0,0,e,0,0])),this},Matrix.prototype.rotate=function(t,e,a){var s,r,i;return 0!==t&&(this.translate(e,a),s=t*Math.PI/180,r=Math.cos(s),i=Math.sin(s),this.queue.push([r,i,-i,r,0,0]),this.cache=null,this.translate(-e,-a)),this},Matrix.prototype.skewX=function(t){return 0!==t&&(this.cache=null,this.queue.push([1,0,Math.tan(t*Math.PI/180),1,0,0])),this},Matrix.prototype.skewY=function(t){return 0!==t&&(this.cache=null,this.queue.push([1,Math.tan(t*Math.PI/180),0,1,0,0])),this},Matrix.prototype.toArray=function(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],1===this.queue.length)return this.cache;for(var t=1;t<this.queue.length;t++)this.cache=combine(this.cache,this.queue[t]);return this.cache},Matrix.prototype.calc=function(t,e,a){var s;return this.queue.length?(this.cache||(this.cache=this.toArray()),[t*(s=this.cache)[0]+e*s[2]+(a?0:s[4]),t*s[1]+e*s[3]+(a?0:s[5])]):[t,e]};const OPERATIONS={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},CMD_SPLIT_RE=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,PARAMS_SPLIT_RE=/[\s,]+/;class SvgUtils{static transformParse(t){let e,a,s=new Matrix;return t.split(CMD_SPLIT_RE).forEach((function(t){if(t.length)if(void 0===OPERATIONS[t])switch(a=t.split(PARAMS_SPLIT_RE).map((function(t){return+t||0})),e){case"matrix":return void(6===a.length&&s.queueMatrix(a));case"scale":return void(1===a.length?s.scale(a[0],a[0]):2===a.length&&s.scale(a[0],a[1]));case"rotate":return void(1===a.length?s.rotate(a[0],0,0):3===a.length&&s.rotate(a[0],a[1],a[2]));case"translate":return void(1===a.length?s.translate(a[0],0):2===a.length&&s.translate(a[0],a[1]));case"skewX":return void(1===a.length&&s.skewX(a[0]));case"skewY":return void(1===a.length&&s.skewY(a[0]))}else e=t})),s}}const PARAM_COUNTS={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},SPECIAL_SPACES=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];class State{constructor(t){this.index=0,this.path=t,this.max=t.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}}class PathParse{static parse(t){var e=new State(t),a=e.max;for(this.skipSpaces(e);e.index<a&&!e.err.length;)this.scanSegment(e);return e.err.length?e.result=[]:e.result.length&&("mM".indexOf(e.result[0][0])<0?(e.err="SvgPath: string should start with `M` or `m`",e.result=[]):e.result[0][0]="M"),{err:e.err,segments:e.result}}static isSpace(t){return 10===t||13===t||8232===t||8233===t||32===t||9===t||11===t||12===t||160===t||t>=5760&&SPECIAL_SPACES.indexOf(t)>=0}static isCommand(t){switch(32|t){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}static isArc(t){return 97==(32|t)}static isDigit(t){return t>=48&&t<=57}static isDigitStart(t){return t>=48&&t<=57||43===t||45===t||46===t}static skipSpaces(t){for(;t.index<t.max&&this.isSpace(t.path.charCodeAt(t.index));)t.index++}static scanFlag(t){var e=t.path.charCodeAt(t.index);return 48===e?(t.param=0,void t.index++):49===e?(t.param=1,void t.index++):void(t.err="SvgPath: arc flag can be 0 or 1 only (at pos "+t.index+")")}static scanParam(t){var e,a=t.index,s=a,r=t.max,i=!1,h=!1,n=!1,c=!1;if(s>=r)t.err="SvgPath: missed param (at pos "+s+")";else if(43!==(e=t.path.charCodeAt(s))&&45!==e||(e=++s<r?t.path.charCodeAt(s):0),this.isDigit(e)||46===e){if(46!==e){if(i=48===e,e=++s<r?t.path.charCodeAt(s):0,i&&s<r&&e&&this.isDigit(e))return void(t.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+a+")");for(;s<r&&this.isDigit(t.path.charCodeAt(s));)s++,h=!0;e=s<r?t.path.charCodeAt(s):0}if(46===e){for(c=!0,s++;this.isDigit(t.path.charCodeAt(s));)s++,n=!0;e=s<r?t.path.charCodeAt(s):0}if(101===e||69===e){if(c&&!h&&!n)return void(t.err="SvgPath: invalid float exponent (at pos "+s+")");if(43!==(e=++s<r?t.path.charCodeAt(s):0)&&45!==e||s++,!(s<r&&this.isDigit(t.path.charCodeAt(s))))return void(t.err="SvgPath: invalid float exponent (at pos "+s+")");for(;s<r&&this.isDigit(t.path.charCodeAt(s));)s++}t.index=s,t.param=parseFloat(t.path.slice(a,s))+0}else t.err="SvgPath: param should start with 0..9 or `.` (at pos "+s+")"}static finalizeSegment(t){var e,a;a=(e=t.path[t.segmentStart]).toLowerCase();var s=t.data;if("m"===a&&s.length>2&&(t.result.push([e,s[0],s[1]]),s=s.slice(2),a="l",e="m"===e?"l":"L"),"r"===a)t.result.push([e].concat(s));else for(;s.length>=PARAM_COUNTS[a]&&(t.result.push([e].concat(s.splice(0,PARAM_COUNTS[a]))),PARAM_COUNTS[a]););}static scanSegment(t){var e,a,s,r,i,h=t.max;if(t.segmentStart=t.index,e=t.path.charCodeAt(t.index),a=this.isArc(e),this.isCommand(e))if(r=PARAM_COUNTS[t.path[t.index].toLowerCase()],t.index++,this.skipSpaces(t),t.data=[],r){for(s=!1;;){for(i=r;i>0;i--){if(!a||3!==i&&4!==i?this.scanParam(t):this.scanFlag(t),t.err.length)return;t.data.push(t.param),this.skipSpaces(t),s=!1,t.index<h&&44===t.path.charCodeAt(t.index)&&(t.index++,this.skipSpaces(t),s=!0)}if(!s){if(t.index>=t.max)break;if(!this.isDigitStart(t.path.charCodeAt(t.index)))break}}this.finalizeSegment(t)}else this.finalizeSegment(t);else t.err="SvgPath: bad command "+t.path[t.index]+" (at pos "+t.index+")"}}function SvgPath(t){if(!(this instanceof SvgPath))return new SvgPath(t);let e=PathParse.parse(t);this.segments=e.segments,this.err=e.err,this.__stack=[]}SvgPath.from=function(t){if("string"==typeof t)return new SvgPath(t);if(t instanceof SvgPath){let e=new SvgPath("");return e.err=t.err,e.segments=t.segments.map((function(t){return t.slice()})),e.__stack=t.__stack.map((function(t){return Matrix("from").queueMatrix(t.toArray())})),e}throw new Error("SvgPath.from: invalid param type "+t)},SvgPath.prototype.__evaluateMatrix=function(t){let e,a=this;t.queue.length&&this.iterate((function(s,r,i,h){let n,c,o,u;switch(s[0]){case"v":n=t.calc(0,s[1],!0),c=0===n[0]?["v",n[1]]:["l",n[0],n[1]];break;case"V":n=t.calc(i,s[1],!1),c=n[0]===t.calc(i,h,!1)[0]?["V",n[1]]:["L",n[0],n[1]];break;case"h":n=t.calc(s[1],0,!0),c=0===n[1]?["h",n[0]]:["l",n[0],n[1]];break;case"H":n=t.calc(s[1],h,!1),c=n[1]===t.calc(i,h,!1)[1]?["H",n[0]]:["L",n[0],n[1]];break;case"a":case"A":let a=t.toArray(),l=new Ellipse(s[1],s[2],s[3]).transform(a);if(a[0]*a[3]-a[1]*a[2]<0&&(s[5]=s[5]?"0":"1"),n=t.calc(s[6],s[7],"a"===s[0]),"A"===s[0]&&s[6]===i&&s[7]===h||"a"===s[0]&&0===s[6]&&0===s[7]){c=["a"===s[0]?"l":"L",n[0],n[1]];break}c=l.isDegenerate()?["a"===s[0]?"l":"L",n[0],n[1]]:[s[0],l.rx,l.ry,l.ax,s[4],s[5],n[0],n[1]];break;case"m":u=r>0,n=t.calc(s[1],s[2],u),c=["m",n[0],n[1]];break;default:for(o=s[0],c=[o],u=o.toLowerCase()===o,e=1;e<s.length;e+=2)n=t.calc(s[e],s[e+1],u),c.push(n[0],n[1])}a.segments[r]=c}),!0)},SvgPath.prototype.__evaluateStack=function(){let t,e;if(this.__stack.length){if(1===this.__stack.length)return this.__evaluateMatrix(this.__stack[0]),void(this.__stack=[]);for(t=Matrix("evaluate"),e=this.__stack.length;--e>=0;)t.queueMatrix(this.__stack[e].toArray());this.__evaluateMatrix(t),this.__stack=[]}},SvgPath.prototype.toString=function(){let t,e,a=[];this.__evaluateStack();for(let s=0;s<this.segments.length;s++)e=this.segments[s][0],t=s>0&&"m"!==e&&"M"!==e&&e===this.segments[s-1][0],a=a.concat(t?this.segments[s].slice(1):this.segments[s]);return a.join(" ").replace(/ ?([achlmqrstvz]) ?/gi,"$1").replace(/ \-/g,"-").replace(/zm/g,"z m")},SvgPath.prototype.translate=function(t,e){return this.__stack.push(Matrix("translate").translate(t,e||0)),this},SvgPath.prototype.scale=function(t,e){return this.__stack.push(Matrix("scale").scale(t,e||0===e?e:t)),this},SvgPath.prototype.rotate=function(t,e,a){return this.__stack.push(Matrix("rotate").rotate(t,e||0,a||0)),this},SvgPath.prototype.skewX=function(t){return this.__stack.push(Matrix("skewX").skewX(t)),this},SvgPath.prototype.skewY=function(t){return this.__stack.push(Matrix("skewY").skewY(t)),this},SvgPath.prototype.matrix=function(t){return this.__stack.push(Matrix("matrix").queueMatrix(t)),this},SvgPath.prototype.transform=function(t){return t.trim()?(this.__stack.push(SvgUtils.transformParse(t)),this):this},SvgPath.prototype.round=function(t){let e,a=0,s=0,r=0,i=0;return t=t||0,this.__evaluateStack(),this.segments.forEach((function(h){let n=h[0].toLowerCase()===h[0];switch(h[0]){case"H":case"h":return n&&(h[1]+=r),r=h[1]-h[1].toFixed(t),void(h[1]=+h[1].toFixed(t));case"V":case"v":return n&&(h[1]+=i),i=h[1]-h[1].toFixed(t),void(h[1]=+h[1].toFixed(t));case"Z":case"z":return r=a,void(i=s);case"M":case"m":return n&&(h[1]+=r,h[2]+=i),r=h[1]-h[1].toFixed(t),i=h[2]-h[2].toFixed(t),a=r,s=i,h[1]=+h[1].toFixed(t),void(h[2]=+h[2].toFixed(t));case"A":case"a":return n&&(h[6]+=r,h[7]+=i),r=h[6]-h[6].toFixed(t),i=h[7]-h[7].toFixed(t),h[1]=+h[1].toFixed(t),h[2]=+h[2].toFixed(t),h[3]=+h[3].toFixed(t+2),h[6]=+h[6].toFixed(t),void(h[7]=+h[7].toFixed(t));default:return e=h.length,n&&(h[e-2]+=r,h[e-1]+=i),r=h[e-2]-h[e-2].toFixed(t),i=h[e-1]-h[e-1].toFixed(t),void h.forEach((function(e,a){a&&(h[a]=+h[a].toFixed(t))}))}})),this},SvgPath.prototype.iterate=function(t,e){let a,s,r,i=this.segments,h={},n=!1,c=0,o=0,u=0,l=0;if(e||this.__evaluateStack(),i.forEach((function(e,a){let s=t(e,a,c,o);Array.isArray(s)&&(h[a]=s,n=!0);let r=e[0]===e[0].toLowerCase();switch(e[0]){case"m":case"M":return c=e[1]+(r?c:0),o=e[2]+(r?o:0),u=c,void(l=o);case"h":case"H":return void(c=e[1]+(r?c:0));case"v":case"V":return void(o=e[1]+(r?o:0));case"z":case"Z":return c=u,void(o=l);default:c=e[e.length-2]+(r?c:0),o=e[e.length-1]+(r?o:0)}})),!n)return this;for(r=[],a=0;a<i.length;a++)if(void 0!==h[a])for(s=0;s<h[a].length;s++)r.push(h[a][s]);else r.push(i[a]);return this.segments=r,this},SvgPath.prototype.abs=function(){return this.iterate((function(t,e,a,s){let r,i=t[0],h=i.toUpperCase();if(i!==h)switch(t[0]=h,i){case"v":return void(t[1]+=s);case"a":return t[6]+=a,void(t[7]+=s);default:for(r=1;r<t.length;r++)t[r]+=r%2?a:s}}),!0),this},SvgPath.prototype.rel=function(){return this.iterate((function(t,e,a,s){let r,i=t[0],h=i.toLowerCase();if(i!==h&&(0!==e||"M"!==i))switch(t[0]=h,i){case"V":return void(t[1]-=s);case"A":return t[6]-=a,void(t[7]-=s);default:for(r=1;r<t.length;r++)t[r]-=r%2?a:s}}),!0),this},SvgPath.prototype.unarc=function(){return this.iterate((function(t,e,a,s){let r,i,h,n=[],c=t[0];return"A"!==c&&"a"!==c?null:("a"===c?(i=a+t[6],h=s+t[7]):(i=t[6],h=t[7]),r=A2C.arcToBezierCurves(a,s,i,h,t[4],t[5],t[1],t[2],t[3]),0===r.length?[["a"===t[0]?"l":"L",t[6],t[7]]]:(r.forEach((function(t){n.push(["C",t[2],t[3],t[4],t[5],t[6],t[7]])})),n))})),this},SvgPath.prototype.unshort=function(){let t,e,a,s,r,i=this.segments;return this.iterate((function(h,n,c,o){let u,l=h[0],p=l.toUpperCase();n&&("T"===p?(u="t"===l,a=i[n-1],"Q"===a[0]?(t=a[1]-c,e=a[2]-o):"q"===a[0]?(t=a[1]-a[3],e=a[2]-a[4]):(t=0,e=0),s=-t,r=-e,u||(s+=c,r+=o),i[n]=[u?"q":"Q",s,r,h[1],h[2]]):"S"===p&&(u="s"===l,a=i[n-1],"C"===a[0]?(t=a[3]-c,e=a[4]-o):"c"===a[0]?(t=a[3]-a[5],e=a[4]-a[6]):(t=0,e=0),s=-t,r=-e,u||(s+=c,r+=o),i[n]=[u?"c":"C",s,r,h[1],h[2],h[3],h[4]]))})),this};export{SvgPath};